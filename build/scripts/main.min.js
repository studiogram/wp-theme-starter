!function(e){"function"==typeof define&&define.amd?define("main",e):e()}((function(){"use strict";function e(){if(!(this instanceof e))return new e;this.size=0,this.uid=0,this.selectors=[],this.selectorObjects={},this.indexes=Object.create(this.indexes),this.activeIndexes=[]}var t=window.document.documentElement,n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.msMatchesSelector;e.prototype.matchesSelector=function(e,t){return n.call(e,t)},e.prototype.querySelectorAll=function(e,t){return t.querySelectorAll(e)},e.prototype.indexes=[];var r=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;e.prototype.indexes.push({name:"ID",selector:function(e){var t;if(t=e.match(r))return t[0].slice(1)},element:function(e){if(e.id)return[e.id]}});var i=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;e.prototype.indexes.push({name:"CLASS",selector:function(e){var t;if(t=e.match(i))return t[0].slice(1)},element:function(e){var t=e.className;if(t){if("string"==typeof t)return t.split(/\s/);if("object"==typeof t&&"baseVal"in t)return t.baseVal.split(/\s/)}}});var o,s=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;e.prototype.indexes.push({name:"TAG",selector:function(e){var t;if(t=e.match(s))return t[0].toUpperCase()},element:function(e){return[e.nodeName.toUpperCase()]}}),e.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}},o="function"==typeof window.Map?window.Map:function(){function e(){this.map={}}return e.prototype.get=function(e){return this.map[e+" "]},e.prototype.set=function(e,t){this.map[e+" "]=t},e}();var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function h(e,t){var n,r,i,o,s,h,c=(e=e.slice(0).concat(e.default)).length,l=t,d=[];do{if(a.exec(""),(i=a.exec(l))&&(l=i[3],i[2]||!l))for(n=0;n<c;n++)if(s=(h=e[n]).selector(i[1])){for(r=d.length,o=!1;r--;)if(d[r].index===h&&d[r].key===s){o=!0;break}o||d.push({index:h,key:s});break}}while(i);return d}function c(e,t){var n,r,i;for(n=0,r=e.length;n<r;n++)if(i=e[n],t.isPrototypeOf(i))return i}function l(e,t){return e.id-t.id}e.prototype.logDefaultIndexUsed=function(){},e.prototype.add=function(e,t){var n,r,i,s,a,l,d,u,f=this.activeIndexes,p=this.selectors,g=this.selectorObjects;if("string"==typeof e){for(g[(n={id:this.uid++,selector:e,data:t}).id]=n,d=h(this.indexes,e),r=0;r<d.length;r++)s=(u=d[r]).key,(a=c(f,i=u.index))||((a=Object.create(i)).map=new o,f.push(a)),i===this.indexes.default&&this.logDefaultIndexUsed(n),(l=a.map.get(s))||(l=[],a.map.set(s,l)),l.push(n);this.size++,p.push(e)}},e.prototype.remove=function(e,t){if("string"==typeof e){var n,r,i,o,s,a,c,l,d=this.activeIndexes,u=this.selectors=[],f=this.selectorObjects,p={},g=1===arguments.length;for(n=h(this.indexes,e),i=0;i<n.length;i++)for(r=n[i],o=d.length;o--;)if(a=d[o],r.index.isPrototypeOf(a)){if(c=a.map.get(r.key))for(s=c.length;s--;)(l=c[s]).selector!==e||!g&&l.data!==t||(c.splice(s,1),p[l.id]=!0);break}for(i in p)delete f[i],this.size--;for(i in f)u.push(f[i].selector)}},e.prototype.queryAll=function(e){if(!this.selectors.length)return[];var t,n,r,i,o,s,a,h,c={},d=[],u=this.querySelectorAll(this.selectors.join(", "),e);for(t=0,r=u.length;t<r;t++)for(o=u[t],n=0,i=(s=this.matches(o)).length;n<i;n++)c[(h=s[n]).id]?a=c[h.id]:(a={id:h.id,selector:h.selector,data:h.data,elements:[]},c[h.id]=a,d.push(a)),a.elements.push(o);return d.sort(l)},e.prototype.matches=function(e){if(!e)return[];var t,n,r,i,o,s,a,h,c,d,u,f=this.activeIndexes,p={},g=[];for(t=0,i=f.length;t<i;t++)if(h=(a=f[t]).element(e))for(n=0,o=h.length;n<o;n++)if(c=a.map.get(h[n]))for(r=0,s=c.length;r<s;r++)!p[u=(d=c[r]).id]&&this.matchesSelector(e,d.selector)&&(p[u]=!0,g.push(d));return g.sort(l)};const d={},u={},f=["mouseenter","mouseleave","pointerenter","pointerleave","blur","focus"];function p(e){void 0===u[e]&&(u[e]=new Set)}function g(e){return"string"==typeof e?document.querySelectorAll(e):e}function m(e){let t=function(e,t){const n=[];let r=t;do{if(1!==r.nodeType)break;const t=e.matches(r);t.length&&n.push({delegatedTarget:r,stack:t})}while(r=r.parentElement);return n}(d[e.type],e.target);if(t.length)for(let n=0;n<t.length;n++)for(let r=0;r<t[n].stack.length;r++)-1!==f.indexOf(e.type)?(w(e,t[n].delegatedTarget),e.target===t[n].delegatedTarget&&t[n].stack[r].data(e)):(w(e,t[n].delegatedTarget),t[n].stack[r].data(e))}function w(e,t){Object.defineProperty(e,"currentTarget",{configurable:!0,enumerable:!0,get:()=>t})}const v=new class{bindAll(e,t){t||(t=Object.getOwnPropertyNames(Object.getPrototypeOf(e)));for(let n=0;n<t.length;n++)e[t[n]]=e[t[n]].bind(e)}on(e,t,n,r){const i=e.split(" ");for(let e=0;e<i.length;e++)if("function"!=typeof t||void 0!==n)if(t.nodeType&&1===t.nodeType||t===window||t===document)t.addEventListener(i[e],n,r);else{t=g(t);for(let o=0;o<t.length;o++)t[o].addEventListener(i[e],n,r)}else p(i[e]),u[i[e]].add(t)}delegate(t,n,r){const i=t.split(" ");for(let t=0;t<i.length;t++){let o=d[i[t]];void 0===o&&(o=new e,d[i[t]]=o,-1!==f.indexOf(i[t])?document.addEventListener(i[t],m,!0):document.addEventListener(i[t],m)),o.add(n,r)}}off(e,t,n,r){const i=e.split(" ");for(let e=0;e<i.length;e++){if(void 0===t){u[i[e]]?.clear();continue}if("function"==typeof t){p(i[e]),u[i[e]].delete(t);continue}const o=d[i[e]];if(void 0===o||(o.remove(t,n),0!==o.size))if(void 0===t.removeEventListener){t=g(t);for(let o=0;o<t.length;o++)t[o].removeEventListener(i[e],n,r)}else t.removeEventListener(i[e],n,r);else delete d[i[e]],-1!==f.indexOf(i[e])?document.removeEventListener(i[e],m,!0):document.removeEventListener(i[e],m)}}emit(e,...t){!function(e,t){u[e]&&u[e].forEach((e=>{e(...t)}))}(e,t)}debugDelegated(){return JSON.parse(JSON.stringify(d))}debugBus(){return function(e){const t={};for(const n in e)t[n]=[...e[n]];return t}(u)}hasBus(e){return this.debugBus().hasOwnProperty(e)}},y=new DOMParser;function L(e){const t=new URL(e,window.location.origin),n=t.hash.length?e.replace(t.hash,""):null;return{hasHash:t.hash.length>0,pathname:t.pathname.replace(/\/+$/,""),host:t.host,search:t.search,raw:e,href:n||t.href}}function E(e,t){e.parentNode.replaceChild(C(e,t),e)}function T(e,t){("HEAD"===e.parentNode.tagName?document.head:document.body).appendChild(C(e,t))}function C(e,t){const n=document.createElement(t);for(let t=0;t<e.attributes.length;t++){const r=e.attributes[t];n.setAttribute(r.nodeName,r.nodeValue)}return e.innerHTML&&(n.innerHTML=e.innerHTML),n}class x{constructor({wrapper:e}){this.wrapper=e}leave(e){return new Promise((t=>{this.onLeave({...e,done:t})}))}enter(e){return new Promise((t=>{this.onEnter({...e,done:t})}))}onLeave({from:e,trigger:t,done:n}){n()}onEnter({to:e,trigger:t,done:n}){n()}}class b{constructor({content:e,page:t,title:n,wrapper:r}){this._contentString=e.outerHTML,this._DOM=null,this.page=t,this.title=n,this.wrapper=r,this.content=this.wrapper.lastElementChild}onEnter(){}onEnterCompleted(){}onLeave(){}onLeaveCompleted(){}initialLoad(){this.onEnter(),this.onEnterCompleted()}update(){document.title=this.title,this.wrapper.appendChild(this._DOM.firstElementChild),this.content=this.wrapper.lastElementChild,this._DOM=null}createDom(){this._DOM||(this._DOM=document.createElement("div"),this._DOM.innerHTML=this._contentString)}remove(){this.wrapper.firstElementChild.remove()}enter(e,t){return new Promise((n=>{this.onEnter(),e.enter({trigger:t,to:this.content}).then((()=>{this.onEnterCompleted(),n()}))}))}leave(e,t,n){return new Promise((r=>{this.onLeave(),e.leave({trigger:t,from:this.content}).then((()=>{n&&this.remove(),this.onLeaveCompleted(),r()}))}))}}class P{data=new Map;regexCache=new Map;add(e,t,n){this.data.has(e)||(this.data.set(e,new Map),this.regexCache.set(e,new RegExp(`^${e}$`))),this.data.get(e).set(t,n),this.regexCache.set(t,new RegExp(`^${t}$`))}findMatch(e,t){for(const[n,r]of this.data)if(e.pathname.match(this.regexCache.get(n))){for(const[e,n]of r)if(t.pathname.match(this.regexCache.get(e)))return n;break}return null}}const S="A transition is currently in progress";class M{isTransitioning=!1;currentCacheEntry=null;cache=new Map;activePromises=new Map;constructor(e={}){const{links:t="a[href]:not([target]):not([href^=\\#]):not([data-taxi-ignore])",removeOldContent:n=!0,allowInterruption:r=!1,bypassCache:i=!1,enablePrefetch:o=!0,renderers:s={default:b},transitions:a={default:x},reloadJsFilter:h=e=>void 0!==e.dataset.taxiReload,reloadCssFilter:c=e=>!0}=e;this.renderers=s,this.transitions=a,this.defaultRenderer=this.renderers.default||b,this.defaultTransition=this.transitions.default||x,this.wrapper=document.querySelector("[data-taxi]"),this.reloadJsFilter=h,this.reloadCssFilter=c,this.removeOldContent=n,this.allowInterruption=r,this.bypassCache=i,this.enablePrefetch=o,this.cache=new Map,this.isPopping=!1,this.attachEvents(t),this.currentLocation=L(window.location.href),this.cache.set(this.currentLocation.href,this.createCacheEntry(document.cloneNode(!0),window.location.href)),this.currentCacheEntry=this.cache.get(this.currentLocation.href),this.currentCacheEntry.renderer.initialLoad()}setDefaultRenderer(e){this.defaultRenderer=this.renderers[e]}setDefaultTransition(e){this.defaultTransition=this.transitions[e]}addRoute(e,t,n){this.router||(this.router=new P),this.router.add(e,t,n)}preload(e,t=!1){return e=L(e).href,this.cache.has(e)?Promise.resolve():this.fetch(e,!1).then((async n=>{this.cache.set(e,this.createCacheEntry(n.html,n.url)),t&&this.cache.get(e).renderer.createDom()})).catch((e=>console.warn(e)))}updateCache(e){const t=L(e||window.location.href).href;this.cache.has(t)&&this.cache.delete(t),this.cache.set(t,this.createCacheEntry(document.cloneNode(!0),t))}clearCache(e){const t=L(e||window.location.href).href;this.cache.has(t)&&this.cache.delete(t)}navigateTo(e,t=!1,n=!1){return new Promise(((r,i)=>{if(!this.allowInterruption&&this.isTransitioning)return void i(new Error(S));this.isTransitioning=!0,this.isPopping=!0,this.targetLocation=L(e),this.popTarget=window.location.href;const o=new(this.chooseTransition(t))({wrapper:this.wrapper});let s;if(this.bypassCache||!this.cache.has(this.targetLocation.href)||this.cache.get(this.targetLocation.href).skipCache){const t=this.fetch(this.targetLocation.href).then((e=>{this.cache.set(this.targetLocation.href,this.createCacheEntry(e.html,e.url)),this.cache.get(this.targetLocation.href).renderer.createDom()})).catch((t=>{window.location.href=e}));s=this.beforeFetch(this.targetLocation,o,n).then((async()=>t.then((async()=>await this.afterFetch(this.targetLocation,o,this.cache.get(this.targetLocation.href),n)))))}else this.cache.get(this.targetLocation.href).renderer.createDom(),s=this.beforeFetch(this.targetLocation,o,n).then((async()=>await this.afterFetch(this.targetLocation,o,this.cache.get(this.targetLocation.href),n)));s.then((()=>{r()}))}))}on(e,t){v.on(e,t)}off(e,t){v.off(e,t)}beforeFetch(e,t,n){return v.emit("NAVIGATE_OUT",{from:this.currentCacheEntry,trigger:n}),new Promise((r=>{this.currentCacheEntry.renderer.leave(t,n,this.removeOldContent).then((()=>{"popstate"!==n&&window.history.pushState({},"",e.raw),r()}))}))}afterFetch(e,t,n,r){return this.currentLocation=e,this.popTarget=this.currentLocation.href,new Promise((i=>{n.renderer.update(),v.emit("NAVIGATE_IN",{from:this.currentCacheEntry,to:n,trigger:r}),this.reloadJsFilter&&this.loadScripts(n.scripts),this.reloadCssFilter&&this.loadStyles(n.styles),"popstate"!==r&&e.href!==n.finalUrl&&window.history.replaceState({},"",n.finalUrl),n.renderer.enter(t,r).then((()=>{v.emit("NAVIGATE_END",{from:this.currentCacheEntry,to:n,trigger:r}),this.currentCacheEntry=n,this.isTransitioning=!1,this.isPopping=!1,i()}))}))}loadScripts(e){const t=[...e],n=Array.from(document.querySelectorAll("script")).filter(this.reloadJsFilter);for(let e=0;e<n.length;e++)for(let r=0;r<t.length;r++)if(n[e].outerHTML===t[r].outerHTML){E(n[e],"SCRIPT"),t.splice(r,1);break}for(const e of t)T(e,"SCRIPT")}loadStyles(e){const t=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).filter(this.reloadCssFilter),n=Array.from(document.querySelectorAll("style")).filter(this.reloadCssFilter),r=e.filter((e=>!e.href||(t.find((t=>t.href===e.href))?void 0:(document.body.append(e),!1))));for(let e=0;e<n.length;e++)for(let t=0;t<r.length;t++)if(n[e].outerHTML===r[t].outerHTML){E(n[e],"STYLE"),r.splice(t,1);break}for(const e of r)T(e,"STYLE")}attachEvents(e){v.delegate("click",e,this.onClick),v.on("popstate",window,this.onPopstate),this.enablePrefetch&&v.delegate("mouseenter focus",e,this.onPrefetch)}onClick=e=>{if(!e.metaKey&&!e.ctrlKey){const t=L(e.currentTarget.href);if(this.currentLocation=L(window.location.href),this.currentLocation.host!==t.host)return;if(this.currentLocation.href!==t.href||this.currentLocation.hasHash&&!t.hasHash)return e.preventDefault(),void this.navigateTo(t.raw,e.currentTarget.dataset.transition||!1,e.currentTarget).catch((e=>console.warn(e)));this.currentLocation.hasHash||t.hasHash||e.preventDefault()}};onPopstate=()=>{const e=L(window.location.href);return!(e.pathname===this.currentLocation.pathname&&e.search===this.currentLocation.search&&!this.isPopping)&&(this.allowInterruption||!this.isTransitioning&&!this.isPopping?(this.isPopping||(this.popTarget=window.location.href),this.isPopping=!0,void this.navigateTo(window.location.href,!1,"popstate")):(window.history.pushState({},"",this.popTarget),console.warn(S),!1))};onPrefetch=e=>{const t=L(e.currentTarget.href);this.currentLocation.host===t.host&&this.preload(e.currentTarget.href,!1)};fetch(e,t=!0){if(this.activePromises.has(e))return this.activePromises.get(e);const n=new Promise(((n,r)=>{let i;fetch(e,{mode:"same-origin",method:"GET",headers:{"X-Requested-With":"Taxi"},credentials:"same-origin"}).then((n=>(n.ok||(r("Taxi encountered a non 2xx HTTP status code"),t&&(window.location.href=e)),i=n.url,n.text()))).then((e=>{var t;n({html:(t=e,"string"==typeof t?y.parseFromString(t,"text/html"):t),url:i})})).catch((n=>{r(n),t&&(window.location.href=e)})).finally((()=>{this.activePromises.delete(e)}))}));return this.activePromises.set(e,n),n}chooseTransition(e){if(e)return this.transitions[e];const t=this.router?.findMatch(this.currentLocation,this.targetLocation);return t?this.transitions[t]:this.defaultTransition}createCacheEntry(e,t){const n=e.querySelector("[data-taxi-view]"),r=n.dataset.taxiView.length?this.renderers[n.dataset.taxiView]:this.defaultRenderer;return r||console.warn(`The Renderer "${n.dataset.taxiView}" was set in the data-taxi-view of the requested page, but not registered in Taxi.`),{page:e,content:n,finalUrl:t,skipCache:n.hasAttribute("data-taxi-nocache"),scripts:this.reloadJsFilter?Array.from(e.querySelectorAll("script")).filter(this.reloadJsFilter):[],styles:this.reloadCssFilter?Array.from(e.querySelectorAll('link[rel="stylesheet"], style')).filter(this.reloadCssFilter):[],title:e.title,renderer:new r({wrapper:this.wrapper,title:e.title,content:n,page:e})}}}class O extends b{initialLoad(){this.onEnter(),this.onEnterCompleted()}onEnter(){this.views=[],this.elements(),this.events()}elements(){}events(){}onEnterCompleted(){console.log("default onEnterCompleted")}onLeave(){console.log("default onLeave")}onLeaveCompleted(){console.log("default onLeaveCompleted")}}class A extends x{onLeave({from:e,trigger:t,done:n}){console.log("leave transition"),n()}onEnter({to:e,trigger:t,done:n}){console.log("enter transition"),n()}}class F extends x{onLeave({from:e,trigger:t,done:n}){console.log("special leave transition"),n()}onEnter({to:e,trigger:t,done:n}){console.log("special enter transition"),n()}}class k extends O{onEnter(){console.log("HOME ENTER")}onLeaveCompleted(){console.log("HOME LEAVE COMPLETED")}}class D{constructor(){this.initTaxi(),this.events()}initTaxi(){this.taxi=new M({renderers:{default:O,frontPage:k},transitions:{default:A,special:F},links:"a:not([target]):not([href^=\\#]):not([data-taxi-ignore]):not([lang])"})}events(){this.taxi.on("NAVIGATE_IN",(({to:e,trigger:t})=>{document.title=e.page.title,document.body.classList=e.page.body.classList,document.head.innerHTML=e.page.head.innerHTML}))}}document.addEventListener("DOMContentLoaded",(()=>{new D}))}));
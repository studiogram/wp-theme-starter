!function(e){"function"==typeof define&&define.amd?define("main",e):e()}((function(){"use strict";function e(){if(!(this instanceof e))return new e;this.size=0,this.uid=0,this.selectors=[],this.selectorObjects={},this.indexes=Object.create(this.indexes),this.activeIndexes=[]}var t=window.document.documentElement,r=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.oMatchesSelector||t.msMatchesSelector;e.prototype.matchesSelector=function(e,t){return r.call(e,t)},e.prototype.querySelectorAll=function(e,t){return t.querySelectorAll(e)},e.prototype.indexes=[];var n=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;e.prototype.indexes.push({name:"ID",selector:function(e){var t;if(t=e.match(n))return t[0].slice(1)},element:function(e){if(e.id)return[e.id]}});var i=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;e.prototype.indexes.push({name:"CLASS",selector:function(e){var t;if(t=e.match(i))return t[0].slice(1)},element:function(e){var t=e.className;if(t){if("string"==typeof t)return t.split(/\s/);if("object"==typeof t&&"baseVal"in t)return t.baseVal.split(/\s/)}}});var o,s=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;e.prototype.indexes.push({name:"TAG",selector:function(e){var t;if(t=e.match(s))return t[0].toUpperCase()},element:function(e){return[e.nodeName.toUpperCase()]}}),e.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}},o="function"==typeof window.Map?window.Map:function(){function e(){this.map={}}return e.prototype.get=function(e){return this.map[e+" "]},e.prototype.set=function(e,t){this.map[e+" "]=t},e}();var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function h(e,t){var r,n,i,o,s,h,c=(e=e.slice(0).concat(e.default)).length,l=t,d=[];do{if(a.exec(""),(i=a.exec(l))&&(l=i[3],i[2]||!l))for(r=0;r<c;r++)if(s=(h=e[r]).selector(i[1])){for(n=d.length,o=!1;n--;)if(d[n].index===h&&d[n].key===s){o=!0;break}o||d.push({index:h,key:s});break}}while(i);return d}function c(e,t){var r,n,i;for(r=0,n=e.length;r<n;r++)if(i=e[r],t.isPrototypeOf(i))return i}function l(e,t){return e.id-t.id}e.prototype.logDefaultIndexUsed=function(){},e.prototype.add=function(e,t){var r,n,i,s,a,l,d,f,u=this.activeIndexes,p=this.selectors,g=this.selectorObjects;if("string"==typeof e){for(g[(r={id:this.uid++,selector:e,data:t}).id]=r,d=h(this.indexes,e),n=0;n<d.length;n++)s=(f=d[n]).key,(a=c(u,i=f.index))||((a=Object.create(i)).map=new o,u.push(a)),i===this.indexes.default&&this.logDefaultIndexUsed(r),(l=a.map.get(s))||(l=[],a.map.set(s,l)),l.push(r);this.size++,p.push(e)}},e.prototype.remove=function(e,t){if("string"==typeof e){var r,n,i,o,s,a,c,l,d=this.activeIndexes,f=this.selectors=[],u=this.selectorObjects,p={},g=1===arguments.length;for(r=h(this.indexes,e),i=0;i<r.length;i++)for(n=r[i],o=d.length;o--;)if(a=d[o],n.index.isPrototypeOf(a)){if(c=a.map.get(n.key))for(s=c.length;s--;)(l=c[s]).selector!==e||!g&&l.data!==t||(c.splice(s,1),p[l.id]=!0);break}for(i in p)delete u[i],this.size--;for(i in u)f.push(u[i].selector)}},e.prototype.queryAll=function(e){if(!this.selectors.length)return[];var t,r,n,i,o,s,a,h,c={},d=[],f=this.querySelectorAll(this.selectors.join(", "),e);for(t=0,n=f.length;t<n;t++)for(o=f[t],r=0,i=(s=this.matches(o)).length;r<i;r++)c[(h=s[r]).id]?a=c[h.id]:(a={id:h.id,selector:h.selector,data:h.data,elements:[]},c[h.id]=a,d.push(a)),a.elements.push(o);return d.sort(l)},e.prototype.matches=function(e){if(!e)return[];var t,r,n,i,o,s,a,h,c,d,f,u=this.activeIndexes,p={},g=[];for(t=0,i=u.length;t<i;t++)if(h=(a=u[t]).element(e))for(r=0,o=h.length;r<o;r++)if(c=a.map.get(h[r]))for(n=0,s=c.length;n<s;n++)!p[f=(d=c[n]).id]&&this.matchesSelector(e,d.selector)&&(p[f]=!0,g.push(d));return g.sort(l)};const d={},f={},u=["mouseenter","mouseleave","pointerenter","pointerleave","blur","focus"];function p(e){void 0===f[e]&&(f[e]=new Set)}function g(e){return"string"==typeof e?document.querySelectorAll(e):e}function m(e){let t=function(e,t){const r=[];let n=t;do{if(1!==n.nodeType)break;const t=e.matches(n);t.length&&r.push({delegatedTarget:n,stack:t})}while(n=n.parentElement);return r}(d[e.type],e.target);if(t.length)for(let r=0;r<t.length;r++)for(let n=0;n<t[r].stack.length;n++)-1!==u.indexOf(e.type)?(w(e,t[r].delegatedTarget),e.target===t[r].delegatedTarget&&t[r].stack[n].data(e)):(w(e,t[r].delegatedTarget),t[r].stack[n].data(e))}function w(e,t){Object.defineProperty(e,"currentTarget",{configurable:!0,enumerable:!0,get:()=>t})}const y=new class{bindAll(e,t){t||(t=Object.getOwnPropertyNames(Object.getPrototypeOf(e)));for(let r=0;r<t.length;r++)e[t[r]]=e[t[r]].bind(e)}on(e,t,r,n){const i=e.split(" ");for(let e=0;e<i.length;e++)if("function"!=typeof t||void 0!==r)if(t.nodeType&&1===t.nodeType||t===window||t===document)t.addEventListener(i[e],r,n);else{t=g(t);for(let o=0;o<t.length;o++)t[o].addEventListener(i[e],r,n)}else p(i[e]),f[i[e]].add(t)}delegate(t,r,n){const i=t.split(" ");for(let t=0;t<i.length;t++){let o=d[i[t]];void 0===o&&(o=new e,d[i[t]]=o,-1!==u.indexOf(i[t])?document.addEventListener(i[t],m,!0):document.addEventListener(i[t],m)),o.add(r,n)}}off(e,t,r,n){const i=e.split(" ");for(let e=0;e<i.length;e++){if(void 0===t){f[i[e]]?.clear();continue}if("function"==typeof t){p(i[e]),f[i[e]].delete(t);continue}const o=d[i[e]];if(void 0===o||(o.remove(t,r),0!==o.size))if(void 0===t.removeEventListener){t=g(t);for(let o=0;o<t.length;o++)t[o].removeEventListener(i[e],r,n)}else t.removeEventListener(i[e],r,n);else delete d[i[e]],-1!==u.indexOf(i[e])?document.removeEventListener(i[e],m,!0):document.removeEventListener(i[e],m)}}emit(e,...t){!function(e,t){f[e]&&f[e].forEach((e=>{e(...t)}))}(e,t)}debugDelegated(){return JSON.parse(JSON.stringify(d))}debugBus(){return function(e){const t={};for(const r in e)t[r]=[...e[r]];return t}(f)}hasBus(e){return this.debugBus().hasOwnProperty(e)}},v=new DOMParser;function L(e){const t=new URL(e,window.location.origin),r=t.hash.length?e.replace(t.hash,""):null;return{hasHash:t.hash.length>0,pathname:t.pathname.replace(/\/+$/,""),host:t.host,search:t.search,raw:e,href:r||t.href}}function E(e,t){e.parentNode.replaceChild(T(e,t),e)}function C(e,t){("HEAD"===e.parentNode.tagName?document.head:document.body).appendChild(T(e,t))}function T(e,t){const r=document.createElement(t);for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];r.setAttribute(n.nodeName,n.nodeValue)}return e.innerHTML&&(r.innerHTML=e.innerHTML),r}class x{constructor({wrapper:e}){this.wrapper=e}leave(e){return new Promise((t=>{this.onLeave({...e,done:t})}))}enter(e){return new Promise((t=>{this.onEnter({...e,done:t})}))}onLeave({from:e,trigger:t,done:r}){r()}onEnter({to:e,trigger:t,done:r}){r()}}class b{constructor({content:e,page:t,title:r,wrapper:n}){this._contentString=e.outerHTML,this._DOM=null,this.page=t,this.title=r,this.wrapper=n,this.content=this.wrapper.lastElementChild}onEnter(){}onEnterCompleted(){}onLeave(){}onLeaveCompleted(){}initialLoad(){this.onEnter(),this.onEnterCompleted()}update(){document.title=this.title,this.wrapper.appendChild(this._DOM.firstElementChild),this.content=this.wrapper.lastElementChild,this._DOM=null}createDom(){this._DOM||(this._DOM=document.createElement("div"),this._DOM.innerHTML=this._contentString)}remove(){this.wrapper.firstElementChild.remove()}enter(e,t){return new Promise((r=>{this.onEnter(),e.enter({trigger:t,to:this.content}).then((()=>{this.onEnterCompleted(),r()}))}))}leave(e,t,r){return new Promise((n=>{this.onLeave(),e.leave({trigger:t,from:this.content}).then((()=>{r&&this.remove(),this.onLeaveCompleted(),n()}))}))}}class P{data=new Map;regexCache=new Map;add(e,t,r){this.data.has(e)||(this.data.set(e,new Map),this.regexCache.set(e,new RegExp(`^${e}$`))),this.data.get(e).set(t,r),this.regexCache.set(t,new RegExp(`^${t}$`))}findMatch(e,t){for(const[r,n]of this.data)if(e.pathname.match(this.regexCache.get(r))){for(const[e,r]of n)if(t.pathname.match(this.regexCache.get(e)))return r;break}return null}}const S="A transition is currently in progress";class M{isTransitioning=!1;currentCacheEntry=null;cache=new Map;activePromises=new Map;constructor(e={}){const{links:t="a[href]:not([target]):not([href^=\\#]):not([data-taxi-ignore])",removeOldContent:r=!0,allowInterruption:n=!1,bypassCache:i=!1,enablePrefetch:o=!0,renderers:s={default:b},transitions:a={default:x},reloadJsFilter:h=e=>void 0!==e.dataset.taxiReload,reloadCssFilter:c=e=>!0}=e;this.renderers=s,this.transitions=a,this.defaultRenderer=this.renderers.default||b,this.defaultTransition=this.transitions.default||x,this.wrapper=document.querySelector("[data-taxi]"),this.reloadJsFilter=h,this.reloadCssFilter=c,this.removeOldContent=r,this.allowInterruption=n,this.bypassCache=i,this.enablePrefetch=o,this.cache=new Map,this.isPopping=!1,this.attachEvents(t),this.currentLocation=L(window.location.href),this.cache.set(this.currentLocation.href,this.createCacheEntry(document.cloneNode(!0),window.location.href)),this.currentCacheEntry=this.cache.get(this.currentLocation.href),this.currentCacheEntry.renderer.initialLoad()}setDefaultRenderer(e){this.defaultRenderer=this.renderers[e]}setDefaultTransition(e){this.defaultTransition=this.transitions[e]}addRoute(e,t,r){this.router||(this.router=new P),this.router.add(e,t,r)}preload(e,t=!1){return e=L(e).href,this.cache.has(e)?Promise.resolve():this.fetch(e,!1).then((async r=>{this.cache.set(e,this.createCacheEntry(r.html,r.url)),t&&this.cache.get(e).renderer.createDom()})).catch((e=>console.warn(e)))}updateCache(e){const t=L(e||window.location.href).href;this.cache.has(t)&&this.cache.delete(t),this.cache.set(t,this.createCacheEntry(document.cloneNode(!0),t))}clearCache(e){const t=L(e||window.location.href).href;this.cache.has(t)&&this.cache.delete(t)}navigateTo(e,t=!1,r=!1){return new Promise(((n,i)=>{if(!this.allowInterruption&&this.isTransitioning)return void i(new Error(S));this.isTransitioning=!0,this.isPopping=!0,this.targetLocation=L(e),this.popTarget=window.location.href;const o=new(this.chooseTransition(t))({wrapper:this.wrapper});let s;if(this.bypassCache||!this.cache.has(this.targetLocation.href)||this.cache.get(this.targetLocation.href).skipCache){const t=this.fetch(this.targetLocation.href).then((e=>{this.cache.set(this.targetLocation.href,this.createCacheEntry(e.html,e.url)),this.cache.get(this.targetLocation.href).renderer.createDom()})).catch((t=>{window.location.href=e}));s=this.beforeFetch(this.targetLocation,o,r).then((async()=>t.then((async()=>await this.afterFetch(this.targetLocation,o,this.cache.get(this.targetLocation.href),r)))))}else this.cache.get(this.targetLocation.href).renderer.createDom(),s=this.beforeFetch(this.targetLocation,o,r).then((async()=>await this.afterFetch(this.targetLocation,o,this.cache.get(this.targetLocation.href),r)));s.then((()=>{n()}))}))}on(e,t){y.on(e,t)}off(e,t){y.off(e,t)}beforeFetch(e,t,r){return y.emit("NAVIGATE_OUT",{from:this.currentCacheEntry,trigger:r}),new Promise((n=>{this.currentCacheEntry.renderer.leave(t,r,this.removeOldContent).then((()=>{"popstate"!==r&&window.history.pushState({},"",e.raw),n()}))}))}afterFetch(e,t,r,n){return this.currentLocation=e,this.popTarget=this.currentLocation.href,new Promise((i=>{r.renderer.update(),y.emit("NAVIGATE_IN",{from:this.currentCacheEntry,to:r,trigger:n}),this.reloadJsFilter&&this.loadScripts(r.scripts),this.reloadCssFilter&&this.loadStyles(r.styles),"popstate"!==n&&e.href!==r.finalUrl&&window.history.replaceState({},"",r.finalUrl),r.renderer.enter(t,n).then((()=>{y.emit("NAVIGATE_END",{from:this.currentCacheEntry,to:r,trigger:n}),this.currentCacheEntry=r,this.isTransitioning=!1,this.isPopping=!1,i()}))}))}loadScripts(e){const t=[...e],r=Array.from(document.querySelectorAll("script")).filter(this.reloadJsFilter);for(let e=0;e<r.length;e++)for(let n=0;n<t.length;n++)if(r[e].outerHTML===t[n].outerHTML){E(r[e],"SCRIPT"),t.splice(n,1);break}for(const e of t)C(e,"SCRIPT")}loadStyles(e){const t=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).filter(this.reloadCssFilter),r=Array.from(document.querySelectorAll("style")).filter(this.reloadCssFilter),n=e.filter((e=>!e.href||(t.find((t=>t.href===e.href))?void 0:(document.body.append(e),!1))));for(let e=0;e<r.length;e++)for(let t=0;t<n.length;t++)if(r[e].outerHTML===n[t].outerHTML){E(r[e],"STYLE"),n.splice(t,1);break}for(const e of n)C(e,"STYLE")}attachEvents(e){y.delegate("click",e,this.onClick),y.on("popstate",window,this.onPopstate),this.enablePrefetch&&y.delegate("mouseenter focus",e,this.onPrefetch)}onClick=e=>{if(!e.metaKey&&!e.ctrlKey){const t=L(e.currentTarget.href);if(this.currentLocation=L(window.location.href),this.currentLocation.host!==t.host)return;if(this.currentLocation.href!==t.href||this.currentLocation.hasHash&&!t.hasHash)return e.preventDefault(),void this.navigateTo(t.raw,e.currentTarget.dataset.transition||!1,e.currentTarget).catch((e=>console.warn(e)));this.currentLocation.hasHash||t.hasHash||e.preventDefault()}};onPopstate=()=>{const e=L(window.location.href);return!(e.pathname===this.currentLocation.pathname&&e.search===this.currentLocation.search&&!this.isPopping)&&(this.allowInterruption||!this.isTransitioning&&!this.isPopping?(this.isPopping||(this.popTarget=window.location.href),this.isPopping=!0,void this.navigateTo(window.location.href,!1,"popstate")):(window.history.pushState({},"",this.popTarget),console.warn(S),!1))};onPrefetch=e=>{const t=L(e.currentTarget.href);this.currentLocation.host===t.host&&this.preload(e.currentTarget.href,!1)};fetch(e,t=!0){if(this.activePromises.has(e))return this.activePromises.get(e);const r=new Promise(((r,n)=>{let i;fetch(e,{mode:"same-origin",method:"GET",headers:{"X-Requested-With":"Taxi"},credentials:"same-origin"}).then((r=>(r.ok||(n("Taxi encountered a non 2xx HTTP status code"),t&&(window.location.href=e)),i=r.url,r.text()))).then((e=>{var t;r({html:(t=e,"string"==typeof t?v.parseFromString(t,"text/html"):t),url:i})})).catch((r=>{n(r),t&&(window.location.href=e)})).finally((()=>{this.activePromises.delete(e)}))}));return this.activePromises.set(e,r),r}chooseTransition(e){if(e)return this.transitions[e];const t=this.router?.findMatch(this.currentLocation,this.targetLocation);return t?this.transitions[t]:this.defaultTransition}createCacheEntry(e,t){const r=e.querySelector("[data-taxi-view]"),n=r.dataset.taxiView.length?this.renderers[r.dataset.taxiView]:this.defaultRenderer;return n||console.warn(`The Renderer "${r.dataset.taxiView}" was set in the data-taxi-view of the requested page, but not registered in Taxi.`),{page:e,content:r,finalUrl:t,skipCache:r.hasAttribute("data-taxi-nocache"),scripts:this.reloadJsFilter?Array.from(e.querySelectorAll("script")).filter(this.reloadJsFilter):[],styles:this.reloadCssFilter?Array.from(e.querySelectorAll('link[rel="stylesheet"], style')).filter(this.reloadCssFilter):[],title:e.title,renderer:new n({wrapper:this.wrapper,title:e.title,content:r,page:e})}}}class O extends b{initialLoad(){console.log("default initialLoad")}onEnter(){console.log("default onEnter")}onEnterCompleted(){console.log("default onEnterCompleted")}onLeave(){console.log("default onLeave")}onLeaveCompleted(){console.log("default onLeaveCompleted")}}class A extends x{onLeave({from:e,trigger:t,done:r}){console.log("leave transition"),r()}onEnter({to:e,trigger:t,done:r}){console.log("enter transition"),r()}}class F extends x{onLeave({from:e,trigger:t,done:r}){console.log("special leave transition"),r()}onEnter({to:e,trigger:t,done:r}){console.log("special enter transition"),r()}}class k extends O{onEnter(){console.log("HOME ENTER")}onLeaveCompleted(){console.log("HOME LEAVE COMPLETED")}}class D{constructor(){this.initTaxi(),this.events()}initTaxi(){this.taxi=new M({renderers:{default:O,frontPage:k},transitions:{default:A,special:F},links:"a:not([target]):not([href^=\\#]):not([data-taxi-ignore]):not([lang])"})}events(){this.taxi.on("NAVIGATE_IN",(({to:e,trigger:t})=>{document.title=e.page.title,document.body.classList=e.page.body.classList}))}}document.addEventListener("DOMContentLoaded",(()=>{new D}))}));